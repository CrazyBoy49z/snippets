# ANMERKUNG: ## Zeilen mit zwei Rauten sind Kommentare, solche mit einer # abgeschaltete Anweisungen. ### Drei Rauten markieren den Beginn thematischer Abschnitte
# Einführung in das Thema .htaccess: https://perishablepress.com/stupid-htaccess-tricks/

### Sicherheitseinstellungen

<IfModule mod_headers.c>
    ## verhindert das Untermogeln faslcher MIME-Typen, etwa das Tarnen von JavaScipt als Bilddateien: http://www.golem.de/news/cross-site-scripting-javascript-code-in-bilder-einbetten-1411-110264-2.html
    Header set X-Content-Type-Options nosniff
    ## Verhindert einige Cross-Site-Scripting-Attacken: https://de.wikipedia.org/wiki/Cross-Site-Scripting
    Header set X-XSS-Protection "1; mode=block"
    ## Unterbindet den Diebstahl der Site, indem deren Inhalt über Frames in andere Seiten eingebunden wird.
    Header set X-Frame-Options SAMEORIGIN
    ## Entfernt den Header, aud dem sich die verwendete PHP Version auslesen lässt
    Header unset X-Powered-By
    ## Unterdrückt die Übertragung von Details über den Server
    Header unset SERVER
    ## mit Content-Securtiy-Policy kann definiert werden, aus welchen Quellen der zum Browser übertragen Code stammen darf. Die Sache ist gut, aber nicht ganz trivial, Erläuterungen siehe https://www.html5rocks.com/en/tutorials/security/content-security-policy/ und https://developer.mozilla.org/en-US/docs/Web/Security/CSP
    # Content-Security-Policy: 
</IfModule>

## Unterdrückt Informationen über den Server: https://httpd.apache.org/docs/2.2/de/mod/core.html#serversignature
ServerSignature Off

## Schützt die .htaccess
<Files ~ "^.*\.([Hh][Tt][Aa])">
    order allow,deny
    deny from all
    satisfy all
</Files>

## Beispiel: Zugriff auf sicherheitsrelevante Dateien unterbinden wie meine-datei.bak oder meine-datei.config. Nur das passende auswählen.
#<FilesMatch "(\.(bak|config|sql|fla|ini|log|sh|inc|swp|dist)|~)$">
#    Order allow,deny
#    Deny from all
#    Satisfy All
#</FilesMatch>

## Unterbindet das Auflisten der Serverdateien im Browser
Options -Indexes
IndexIgnore *

## Beschränkt die Größe der hochladbaren Dateien und erschwert so einen Weg von DoS-Attacken. Angabe in Bits. 
# LimitRequestBody 10240000
## Erst für die produktive Site freigeben. Pfad ermitteln mit PHP-Datei im root der Site mit folgendem Inhalt: <?php echo $_SERVER["DOCUMENT_ROOT"] ?> Datei anschließend löschen!
# php_value open_basedir /www/htdocs/pfad-zur-installation

### Server-Einstellungen

## Veraltet! Ab PHP 5.4 überflüssig. Aber wer fährt schon auf älteren Systemen?
# php_flag magic_quotes_gpc off
## Veraltet
# php_value date.timezone Europe/Berlin

## Hauptsprache festlegen
DefaultLanguage de-DE
## Zeichensatz definieren
AddDefaultCharset UTF-8
## Zeitzone bestimmen
SetEnv TZ Europe/Berlin

#### ! Vorläufiges Ende der überabreiten Einstellungen


#Options +FollowSymlinks
RewriteEngine On
RewriteBase /

#Redirect 301 /neu http://domain.tld/alt


# Fix Apache internal dummy connections from breaking [(site_url)] cache
RewriteCond %{HTTP_USER_AGENT} ^.*internal\ dummy\ connection.*$ [NC]
RewriteRule .* - [F,L]

# Rewrite domain.com -> www.domain.com -- used with SEO Strict URLs plugin
#RewriteCond %{HTTP_HOST} .
#ewriteCond %{HTTP_HOST} !^www\.example\.com [NC]
#RewriteRule (.*) http://www.example.com/$1 [R=301,L]

# without www
#RewriteCond %{HTTP_HOST} .
#RewriteCond %{HTTP_HOST} !^domain\.tld [NC]
#RewriteRule (.*) http://domain.tld/$1 [R=301,L]

# without www  all domian
#RewriteCond %{HTTP_HOST} .
#RewriteCond %{HTTP_HOST} ^www.(.*)$ [NC]
#RewriteRule ^(.*)$ http://%1/$1 [R=301,L]

# Exclude /assets and /manager directories and images from rewrite rules
RewriteRule ^(manager|assets|js|css|images|img)/.*$ - [L]
RewriteRule \.(jpg|jpeg|png|gif|ico)$ - [L]

# Zeitstempel einf¸gen
RewriteRule (.+)\.(min|dev)\.(\d+)\.(js|css)$ $1.$2.$4 [L]

#RewriteCond %{HTTP_REFERER} ^http://.*somebadforum\.com [NC,OR]
# RewriteRule .* - [F,L] 


# For Friendly URLs
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php?q=$1 [L,QSA]

#RewriteCond %{HTTPS} !=on
#RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
#RewriteRule ^(.*)$ https://%1/$1 [R=301,L]


RewriteCond %{REQUEST_SCHEME} http [OR]
RewriteCond %{HTTP_HOST} ^www\.
# !!! https?
RewriteRule ^ https://DOMAIN.TLD%{REQUEST_URI} [NE,L,R] 
#RewriteRule (.*) https://junkers-paddelgemeinschaft.de/$1 [R=301,L]

#RewriteCond %{HTTPS} on
#RewriteCond %{HTTP_HOST} ^www\.(.*)
#RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

# without www
#RewriteCond %{HTTPS} on
#RewriteCond %{HTTP_HOST} .
#RewriteCond %{HTTP_HOST} !^DOMAIN\.TLD [NC]
#RewriteRule (.*) https://DOMAIN.TLD/$1 [R=301,L]


#unsinige Google-Anfrage
RedirectMatch 403 (?i)\.well-known
RedirectMatch 403 (?i)apple-app-site-association

# Reduce server overhead by enabling output compression if supported.
#php_flag zlib.output_compression On
#php_value zlib.output_compression_level 5

<IfModule mod_mime.c>

	AddCharset utf-8 .html .css .js .xml .json .rss .vtt .xml

	DefaultType text/html
	
	AddType application/pdf 					pdf
	AddType text/css 							css
	AddType text/javascript 					js
	AddType application/javascript          	js
	AddType application/json                	json
	
	AddType image/jpeg 							jpg
	AddType image/png 							png
	AddType image/gif 							gif
	AddType image/x-icon 						ico
	
	AddType image/svg+xml  						svg svgz 
	AddEncoding gzip  							svgz
	
	AddType font/truetype                  		ttf
	AddType application/x-font-woff        		woff
	AddType application/font-woff2  			woff2
	
	AddType audio/mpeg 							mp3
	AddType audio/mp4 							m4a mp4 mpa                                                           
	AddType audio/ogg 							ogg
	AddType audio/ogg 							oga
	AddType audio/webm 							webma
	AddType audio/wav 							wav
	
	AddType video/ogg 							ogv
	AddType video/ogg 							ogg
	AddType video/mp4 							mp4
	AddType video/webm 							webm
	AddType application/x-shockwave-flash   	swf
	
	AddType text/calendar                       ics  
	
	AddType application/xml                     rss atom xml rdf
	AddType application/x-chrome-extension      crx
	AddType application/x-opera-extension       oex
	AddType application/x-xpinstall             xpi
	AddType application/octet-stream            gpx
	AddType application/octet-stream            kml
	AddType application/octet-stream            kmz 
	AddType text/x-vcard                        vcf
	AddType text/vtt                            vtt
	
	
</IfModule>


<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/calendar text/css text/javascript application/json application/javascript application/vnd.google-earth.kml+xml image/svg+xml 
    # alte Browser
    BrowserMatch ^Mozilla/4 gzip-only-text/html
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
    BrowserMatch \bMSIE !no-gzip !gzip-only-text/html 
    # ausschlieszen
    SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png|pdf|mp3|wav|wma|au|m4p|snd|mid|wmv|mpg|mpeg|mp4|qt|mov|exe|t?gz|zip|gz2|sit|rar|woff|woff2)$ no-gzip
</IfModule>

<IfModule mod_expires.c>
	ExpiresActive on
	ExpiresDefault "access plus 1 month"
	 
	# CSS
	ExpiresByType text/css "access plus 1 year"
	
	# Data interchange
	ExpiresByType application/atom+xml "access plus 1 hour"
	ExpiresByType application/rdf+xml "access plus 1 hour"
	ExpiresByType application/rss+xml "access plus 1 hour"
	ExpiresByType application/json "access plus 0 seconds"
	ExpiresByType application/vnd.geo+json "access plus 0 seconds"
	ExpiresByType application/xml "access plus 0 seconds"
	ExpiresByType text/xml "access plus 0 seconds"
	ExpiresByType text/calendar "access plus 6 hours"
	
	# Favicon (cannot be renamed!) and cursor images
	ExpiresByType image/vnd.microsoft.icon "access plus 1 week"
	ExpiresByType image/x-icon "access plus 1 week"
	
	# HTML
	ExpiresByType text/html "access plus 5 minutes"
	
	# JavaScript
	ExpiresByType application/javascript "access plus 1 year"
	ExpiresByType application/x-javascript "access plus 1 year"
	ExpiresByType text/javascript "access plus 1 year"
	
	# Manifest files
	ExpiresByType application/manifest+json "access plus 1 year"
	ExpiresByType application/x-web-app-manifest+json "access plus 0 seconds"
	ExpiresByType text/cache-manifest "access plus 0 seconds"
	
	# Media files
	ExpiresByType audio/ogg "access plus 1 year"
	ExpiresByType image/bmp "access plus 1 year"
	ExpiresByType image/gif "access plus 1 year"
	ExpiresByType image/jpeg "access plus 1 year"
	ExpiresByType image/png "access plus 1 year"
	ExpiresByType image/svg+xml "access plus 1 year"
	ExpiresByType video/mp4 "access plus 1 year"
	ExpiresByType video/ogg "access plus 1 year"
	ExpiresByType video/webm "access plus 1 year"
	
	# Web fonts
	ExpiresByType application/x-font-ttf "access plus 1 year"
	ExpiresByType application/font-woff "access plus 1 year"
	ExpiresByType application/x-font-woff "access plus 1 year"
	ExpiresByType font/woff "access plus 1 year"
	ExpiresByType application/font-woff2 "access plus 1 year"
	
	# Other
	ExpiresByType text/x-cross-domain-policy "access plus 1 week" 
  
  	# alte Browser
  	BrowserMatch "MSIE" brokenvary=1
	BrowserMatch "Mozilla/4.[0-9]{2}" brokenvary=1
	BrowserMatch "Opera" !brokenvary
	SetEnvIf brokenvary 1 force-no-vary


  
</IfModule>


Header set Connection keep-alive
Header unset ETag
Header set Cache-Control "private, no-transform"
<FilesMatch "\.(css|gif|jpe?g|pdf|png|svg|ttf|woff|woff2)$">
    Header set Cache-Control "public, private"
</FilesMatch>
    
FileETag None

#php_flag log_errors on
#php_value error_log "/www/htdocs/w00f2f21/errlog/errlog.txt"
